---
title: "open plants"
author: "Julin Maloof"
date: "10/26/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(jsonlite)
```


```{r}
info <- jsonlite::fromJSON("open_plants/annotations_all.json")
```

```{r}
head(info)
dim(info)
```

For each species and each growth condition do an 80/10/10 split

First, how many images in of each class?

```{r}
info %>% group_by(eppo, growth_condition) %>%
  summarize(count=n())
```
want to eliminate species with low #s

```{r}
info %>% group_by(eppo, growth_condition) %>%
  summarize(count=n()) %>%
  group_by(eppo) %>%
  summarize(min_count=min(count)) %>%
  arrange(min_count)

keep <- info %>% group_by(eppo, growth_condition) %>%
  summarize(count=n()) %>%
  group_by(eppo) %>%
  summarize(min_count=min(count)) %>%
  filter(min_count > 99) %>%
  pull(eppo)
```

```{r}
info.sm <- info %>%
  filter(eppo %in% keep) %>%
  group_by(eppo, growth_condition) %>%
  mutate(group=cut(percent_rank(row_number()),
                   breaks=c(-1, 0.8, 0.9, 1),
                   labels=c("train", "validate", "test"))
  )
  
head(info.sm)
```



